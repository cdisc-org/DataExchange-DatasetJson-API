# Dataset-JSON v1.1 REST API Specification

This standard REST API specification for Dataset-JSON is based on the version 1.1 specification found in [Dataset-JSON
GitHub repository](https://github.com/cdisc-org/DataExchange-DatasetJson).

## Open API Specification

The primary technical documentation for the Dataset-JSON API is found in the [Open API Specification 3.1 (OAS)](https://github.com/cdisc-org/DataExchange-DatasetJson-API/blob/main/openapi/dataset-json-api.json).
An [HTML version of the specification](https://github.com/cdisc-org/DataExchange-DatasetJson-API/blob/main/dataset-json-api.html) 
is also available for viewing. The HTML presents best when loaded from the drive where the DataExchange-DatasetJson-API
has been cloned as it uses the content of the swagger-ui folder to render correctly.

The OAS Dataset-JSON API specification includes a machine-readable representation of the endpoints and JSON payload.
An OAS specification can be used by software tools to generate client and server code.

## API Implementations
The specification focuses on data exchange to keep the API simple to implement. Implementers may seek to extend the API
to add additional features, such as filtering datasets for specific rows that meet a given criteria, but these
advanced features are not part of the standard. The standard was developed to be easy to implement.

For those implementing the API, there are 2 paths to conformance with the standard
1. Implement the GET verbs completely to create a read-only API. 
2. A read/write API that allows clients to read, write, update, append, and delete datasets.

A read-only implementation of the standards implements all the GET verbs, and not the other verbs. For example, an 
EDC system implementing the API may allow clients to retrieve datasets, but not to create or update datasets.

Systems must implement the specification completely to be conformant. For a read-only implementation this means
implementing each GET request completely to include all parameters and features. Read/write implementations must
implement all verbs with all parameters and features in the specification.

## HTTP Verbs
* GET is used to retrieve content such as a list of studies, a study, a list of datasets, or a dataset
* POST is used to create a new study or dataset
* PUT is used to update an entire study or dataset
* PATCH is used to append a data rows to a dataset
* DELETE is used to soft delete a study or dataset

## Usage

For the purposes of this specification, example endpoints will use a local IP address: 
```
http://127.0.0.1:8000/
```

To load the API documentation generated by the OAS specification:
```
http://127.0.0.1:8000/docs#/
```

Note: You will need to replace the host name and port to match the API implementation. For example:
```
https://dsjapi.net/
```

## Usage Examples
Replace the host and port to match the API implementation. The api_key must be replaced with a valid key
Please note that the test data files are available in the
data directory.

### Read-only Examples

| Description                             | Description                                                                                                                                                                                                                                                    |
|-----------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| GET the about resource                  | curl http://127.0.0.1:8000/about                                                                                                                                                                                                                               |
| GET the home resource (html page)       | curl http://127.0.0.1:8000/                                                                                                                                                                                                                                    |
| GET the current list of studies         | curl http://127.0.0.1:8000/studies                                                                                                                                                                                                                             |
| GET a specific study                    | curl http://127.0.0.1:8000/studies/CDISCPILOT01                                                                                                                                                                                                                |
| GET the list of datasets for a specified study | curl http://127.0.0.1:8000/studies/CDISCPILOT02/datasets                                                                                                                                                                                                       |
| GET the list of datasets for a specified study and filter by datetime | curl http://127.0.0.1:8000/studies/CDISCPILOT02/datasets -H "IF-Modified-Since: 2024-01-10T20:38:47"                                                                                                                                                           |
| GET the list of datasets with a standard filter of sdtmig | curl http://127.0.0.1:8000/studies/CDISCPILOT02/datasets?standard=sdtmig                                                                                                                                                                                       |
| GET the list of datasets for a specified study and filter by datetime and standard |                                                                                                                                                                                                                                                                |
| GET the IG.AE dataset                   | curl http://127.0.0.1:8000/studies/CDISCPILOT01/datasets/IG.AE                                                                                                                                                                                                 |
| GET the IG.AE dataset with IF-Modified-Since same as creationDateTime | curl http://127.0.0.1:8000/studies/CDISCPILOT01/datasets/IG.AE -i -H "IF-Modified-Since: 2024-01-10T20:38:47"                                                                                                                                                  |
| GET gzipped content (may have to set config minimum_records=2 to trigger compression) | curl http://127.0.0.1:8000/studies/CDISCPILOT02/datasets/IG.DD?standard=sdtmig -H "Accept-Encoding: gzip, deflate"                                                                                                                                             |
| GET dataset metadata only               | curl http://127.0.0.1:8000/studies/CDISCPILOT01/datasets/IG.AE?metadataonly=True                                                                                                                                                                               |
| GET page of data using offset and limit | curl "http://127.0.0.1:8000/studies/CDISCPILOT01/datasets/IG.AE?offset=10&limit=40"                                                                                                                                                                            |

### Write, Update, Append, Delete Examples

| Description                             | Description                                                                                                                                                                                                                                                    |
|-----------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| POST a new study                        | curl http://127.0.0.1:8000/studies -H "Content-Type: application/json" -H "api-key: x1y62c5b-e29d-8fa5-af31-63c2be65681a" -d  "{\"oid\": \"CDISCPILOT03\", \"name\": \"CDISCPILOT03\", \"label\": \"Study Data Tabulation Model Metadata Submission Guidelines Sample Study\", \"standards\": [\"sdtmig\"], \"href\": \"/studies/CDISCPILOT03\"}" |
| PUT update the newly added study        | curl http://127.0.0.1:8000/studies/CDISCPILOT03 -X PUT -H "Content-Type: application/json" -H "api-key: x1y62c5b-e29d-8fa5-af31-63c2be65681a" -d  "{\"oid\": \"CDISCPILOT03\", \"name\": \"CDISCPILOT03\", \"label\": \"SDTM MSG Sample Study\", \"standards\": [\"sdtmig\"], \"href\": \"/studies/CDISCPILOT03\"}" |
| POST add a new dataset to the new study | curl http://127.0.0.1:8000/studies/CDISCPILOT03/datasets -H "Content-Type: application/json" -H "api-key: x1y62c5b-e29d-8fa5-af31-63c2be65681a" -d  @.\test-data\ig-dd.json                                                     |
| PUT update the newly added dataset      | curl http://127.0.0.1:8000/studies/CDISCPILOT03/datasets/IG.DD -X PUT -H "Content-Type: application/json" -H "api-key: x1y62c5b-e29d-8fa5-af31-63c2be65681a" -d  @.\test-data\ig-dd-put.json                                                                   |
| PATCH append a record to the newly added dataset | curl http://127.0.0.1:8000/studies/CDISCPILOT03/datasets/IG.DD -X PATCH -H "Content-Type: application/json" -H "api-key: x1y62c5b-e29d-8fa5-af31-63c2be65681a" -d @.\test-data\ig-dd-patch.json                                                                |
| POST add new dataset to the new study using Gzip compression | curl http://127.0.0.1:8000/studies/CDISCPILOT03/datasets -H "Content-Encoding: application/gzip" -H "Content-Type: application/json" -H "api-key: x1y62c5b-e29d-8fa5-af31-63c2be65681a" --data-binary @.\test-data\ig-ta.gz                                    |
| DELETE the IG.TA dataset | curl http://127.0.0.1:8000/studies/CDISCPILOT03/datasets/IG.TA -X DELETE -I -H "api-key: x1y62c5b-e29d-8fa5-af31-63c2be65681a"                                                                                                                                 |


### Implementation Notes
* If no datasets that match the criteria are found a status code of 200 with content {'datasets': []} is returned
* If a specific dataset is requested by not found a 404 status code is returned
* The standard filter is not case-sensitive

## Assumptions
* The API will not be supporting so many active studies at one time that a filter is needed on the studies returned
* Most dataset retrievals will use gzip compression
